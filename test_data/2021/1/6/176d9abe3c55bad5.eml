Delivered-To: josh@josh.is
Received: by 2002:a2e:b5af:0:0:0:0:0 with SMTP id f15csp1146035ljn;
        Wed, 6 Jan 2021 13:48:09 -0800 (PST)
X-Received: by 2002:a17:906:2e85:: with SMTP id o5mr4150907eji.521.1609969689540;
        Wed, 06 Jan 2021 13:48:09 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1609969689; cv=none;
        d=google.com; s=arc-20160816;
        b=m4kIC2nv5GbhcQhge5iKUs2s1Iep1BWh2X499gDePYESmIa5tohvxHcO0hoYYJgfMr
         jIuee5f9xHnnvgOYDQiV2z63rJ9vhSHqA5+xT1Moii/IrJuzatbZ3pa72DoCLwh3Lsg0
         Qs3nwr7U/I6qvlqegK8XbOpJxmYLcFdO1eGJnGtbxOoG68C0g3KBA3ChwzDAdEiZ/J1L
         wvmDqBBCqmpB9MdkEvXzNiicIvHjZwa3pWdWvlY0cgEJAoe9wdfXyvsx0XUOoeMgMEqw
         4+pIAAVEq8ax5OByQYVgGIRjJruBY8m5NneGLfXUPEUWNh97+dDlJuI7lQD72A8DxAzT
         0XJw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:in-reply-to:references:mime-version
         :dkim-signature;
        bh=1aczyc5wSUJLvPBR5Giu7Wj/8vhO6Xq7seDcDu7K3kU=;
        b=CU/EAE9OIq8LmtIYxoQcoAv8ELRlsNF20ceZyY9z6eOB5mIwqmPrbGCA/10SSULGAW
         lBGSLGe+9oUTj7r5KUgcyo6XT9Qyv7+tq+iF5K3tZKMJk6ETvMnyPftlaPg9sp8Y2AcO
         Ry/8eCAho6h/i1S4X+Dvp0v3vuJpnbIsEVJyl6EYtPggyVPjR2Xv1OEsLrNfTpR3ETbF
         W8NOrfJlwDuG+xJH3LGET8mkp2+t37LiX8fp7Y71Ys9a1MS/orqyQUiy5uGOtcKeqY61
         vUQ7c7e93kXJlQlMmgkoVyYSLrSmZJ2jYMp0jWcGRsHIdCGm31kHAbrT+1E/LCYpXdQS
         HXGQ==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=C3UcYxAc;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Return-Path: <stevebond@gmail.com>
Received: from mail-sor-f41.google.com (mail-sor-f41.google.com. [209.85.220.41])
        by mx.google.com with SMTPS id p4sor4006755edw.20.2021.01.06.13.48.09
        for <josh@josh.is>
        (Google Transport Security);
        Wed, 06 Jan 2021 13:48:09 -0800 (PST)
Received-SPF: pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) client-ip=209.85.220.41;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=C3UcYxAc;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to;
        bh=1aczyc5wSUJLvPBR5Giu7Wj/8vhO6Xq7seDcDu7K3kU=;
        b=C3UcYxAc3StKjX366paajEYLv8gXY2qOyLH/pvGXRSepynvU9dfTVyNHfkcgPywdR0
         Dul9Jppc7c2Lk17snAewa3rcc4UmDTX2Pru5trdj/gs5aS86jTiXap40a18ypa25Hwf+
         K6ApxXPWy6pOur6ANmjWVY9z+lkvzb1J35mYE8NwCLywZZqKIpe6fTfQ7cbFjBc8GOLj
         MHNxpdTBx8SCgfZVz1sE+dqkf94/mSrvtgzHLup2YTCKmTMrnsejm2UM731LNdBS/jIC
         UZoIimlORUl+qZ/dSfdGDQlGTGfjw1XY910fUcGK3uVZIAE24zZ09e+vT/iFsoUhmayL
         nnYQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to;
        bh=1aczyc5wSUJLvPBR5Giu7Wj/8vhO6Xq7seDcDu7K3kU=;
        b=W+Wuwp/FIKOZzGQ8OGGiEvbONbda35HvUWcBIKqNZ05cRdewd/90++p3XVwAHmGAzx
         mS53T0mzULMV6S3Akh/vIlfr9uhQ1Kj97A4rmrBVngz0hkjRl0fGsoxZiZUn1mjlRqpn
         AVmLFlfbs0Arxu7N0u0dDk1d0xT3CdBjr3jOgK3Bxbo7Smr3Iv9GLVeba7v5YwF69lP4
         Y9DUx6RWrc7Wfh2QoYOKHu8lre/VA5PxbcccIua+sD163o1Y10uoWnLpsA7NOGhQZTK6
         6WP1HVOQsf4rAoh4uz9lBkfTxIWRKJWJGRAeur6u7BSASaVnGsQB5WyQbHRyZjl5gDIc
         UKew==
X-Gm-Message-State: AOAM531idtAKHFtDd3fVrF38bhA22OkrcHlkFNXlC4tJ52ENh9+x54O4
	2R8satu3li2/5s95z3emgnFLtUopSNvd3e5fFpvjECQSNBg=
X-Google-Smtp-Source: ABdhPJzHzSCEahp+/DzpNp7EV+p74h7MuVfRlszZMcS1Ri1XchjA5sqG7zqywlDSMOtga6BfITIOTBsZZwMLSZ809/g=
X-Received: by 2002:aa7:d64d:: with SMTP id v13mr5398865edr.196.1609969689120;
 Wed, 06 Jan 2021 13:48:09 -0800 (PST)
MIME-Version: 1.0
References: <CAAdG8Ph0dzJfn6CSm01U8JwNe7x36fzqnXDbqaXV9of8qpqp-w@mail.gmail.com>
 <CACNgykP2XsKcZ3hn6OBepJ1gUs9nBA1hqTxUHDc0pA-O9ksXBQ@mail.gmail.com>
In-Reply-To: <CACNgykP2XsKcZ3hn6OBepJ1gUs9nBA1hqTxUHDc0pA-O9ksXBQ@mail.gmail.com>
From: Steve Bond <stevebond@gmail.com>
Date: Wed, 6 Jan 2021 13:47:58 -0800
Message-ID: <CAAdG8Pg=oeRjeM6Lm93d1PdZhkmz4Z+GtK-H-AEHs7p-Pr==6w@mail.gmail.com>
Subject: Re: Reducing Crowbox power consumption
To: Josh Klein <josh@josh.is>
Content-Type: multipart/alternative; boundary="0000000000006b53d005b84247e7"

--0000000000006b53d005b84247e7
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Nah, not a lot of work. Enough to perform the power measurements before
investing in the code change, but not bad. I mean, half day or so. Then
some testing.



On Wed, Jan 6, 2021 at 1:45 PM Josh Klein <josh@josh.is> wrote:

> Ok, makes sense. Do you think it=E2=80=99s be a huge amount of work to re=
do the
> perch sensor logic if it DOES offer bug savings?
>
> Stoked to find out how much juice this saves!!
>
> - J
>
>
> On Wed, Jan 6, 2021 at 9:39 PM Steve Bond <stevebond@gmail.com> wrote:
>
>> This is an issue I want to push along a bit. If we can get the idle
>> current draw to come down a bit, people will get a lot more runtime from
>> their batteries and perhaps require less expensive solar panels.
>>
>> In order to put an Arduino to sleep, you must have interrupts set to wak=
e
>> it up.
>>
>> The UNO only supports interrupts on pins 2 and 3. This is something I
>> took under consideration when pinning out the Crowbox; The coin sensor i=
s
>> assigned to Pin2, and the perch switches to Pin3. This is good.
>>
>> Currently, the coin sensor is already configured as an interrupt. This i=
s
>> to ensure that a coin deposit is never missed, even if a coin is dropped=
 in
>> while we're in a blocking operation like opening or closing the reward l=
id.
>> All deposits are counted and queued, and we pay out reward access for ea=
ch
>> coin. All works just as we want it to.
>>
>> The perch is NOT set up as an interrupt right now. It's a sensor that we
>> poll very frequently to detect state changes (bird arrives/bird leaves).=
 We
>> don't poll this sensor during blocking operations like opening or closin=
g
>> the lid. If we're already doing one of those two things, we don't really
>> care whether a bird leaves. The departure will be detected as soon as
>> whatever the sliding lid is doing completes.
>>
>> To take a pin that's already set up to do some work as an interrupt (the
>> coin sensor) and set it to wake a sleeping Arduino is almost no work, so=
 we
>> don't have to worry about the coin sensor.
>>
>> I'm going to have to rewrite the logic for how we poll the perch for
>> state changes so it can function as an interrupt because we also need pe=
rch
>> activity to wake a sleeping Crowbox.
>>
>> FOR NOW: I can ignore the perch and just write the code to sleep the
>> Arduino and wake it on deposit. That's all the work that's required to g=
et
>> this fucker to sleep and measure the consumption. No sense reworking all
>> the perch logic if the sleep mode doesn't offer us significant energy
>> savings.
>>
>> -Steve
>>
>>

--0000000000006b53d005b84247e7
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Nah, not a lot of work. Enough to perform the power measur=
ements before investing in the code change, but not bad. I mean, half day o=
r so. Then some testing.<div><br></div><div><br></div></div><br><div class=
=3D"gmail_quote"><div dir=3D"ltr" class=3D"gmail_attr">On Wed, Jan 6, 2021 =
at 1:45 PM Josh Klein &lt;<a href=3D"mailto:josh@josh.is">josh@josh.is</a>&=
gt; wrote:<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0=
px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><div =
dir=3D"auto">Ok, makes sense. Do you think it=E2=80=99s be a huge amount of=
 work to redo the perch sensor logic if it DOES offer bug savings?</div><di=
v dir=3D"auto"><br></div><div dir=3D"auto">Stoked to find out how much juic=
e this saves!!</div><div dir=3D"auto"><br></div><div dir=3D"auto">- J</div>=
<div dir=3D"auto"><br></div><div><br><div class=3D"gmail_quote"><div dir=3D=
"ltr" class=3D"gmail_attr">On Wed, Jan 6, 2021 at 9:39 PM Steve Bond &lt;<a=
 href=3D"mailto:stevebond@gmail.com" target=3D"_blank">stevebond@gmail.com<=
/a>&gt; wrote:<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0=
px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><=
div dir=3D"ltr">This is an issue I want to push along a bit. If we can get =
the idle current draw to come down a bit, people will get a lot more runtim=
e from their batteries and perhaps require less expensive solar panels.=C2=
=A0<div><br></div><div>In order to put an Arduino to sleep, you must have i=
nterrupts set to wake it up.</div><div><br></div><div>The UNO only supports=
 interrupts on pins 2 and 3. This is something I took under consideration w=
hen pinning out the Crowbox; The coin sensor is assigned to Pin2, and the p=
erch switches to Pin3. This is good.</div><div><br></div><div>Currently,=C2=
=A0the coin sensor is already configured as an interrupt. This is to ensure=
 that a coin deposit is never missed, even if a coin is dropped in while we=
&#39;re in a blocking operation like opening or closing the reward lid. All=
 deposits are counted and queued, and we pay out reward access for each coi=
n. All works just as we want it to.</div><div><br></div><div>The perch is N=
OT set up as an interrupt right now. It&#39;s a sensor that we poll very fr=
equently to detect state changes (bird arrives/bird leaves). We don&#39;t p=
oll this sensor during blocking operations like opening or closing the lid.=
 If we&#39;re already doing one of those two things, we don&#39;t really ca=
re whether a bird leaves. The departure will be detected as soon as whateve=
r the sliding lid is doing completes.</div><div><br></div><div>To take a pi=
n that&#39;s already set up to do some work as an interrupt (the coin senso=
r) and set it to wake a sleeping Arduino is almost no work, so we don&#39;t=
 have to worry about the coin sensor.</div><div><br></div><div>I&#39;m goin=
g to have to rewrite the logic for how we poll the perch for state changes =
so it can function as an interrupt because we also need perch activity to w=
ake a sleeping Crowbox.</div><div><br></div><div>FOR NOW: I can ignore the =
perch and just write the code to sleep the Arduino and wake it on deposit. =
That&#39;s all the work that&#39;s required to get this fucker to sleep and=
 measure the consumption. No sense reworking all the perch logic if the sle=
ep mode doesn&#39;t offer us significant energy savings.</div></div><div di=
r=3D"ltr"><div><br></div><div>-Steve</div><div><br></div></div>
</blockquote></div></div>
</blockquote></div>

--0000000000006b53d005b84247e7--
