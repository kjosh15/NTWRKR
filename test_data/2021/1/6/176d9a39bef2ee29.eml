Delivered-To: josh@josh.is
Received: by 2002:a2e:b5af:0:0:0:0:0 with SMTP id f15csp1141867ljn;
        Wed, 6 Jan 2021 13:39:06 -0800 (PST)
X-Received: by 2002:a17:906:b09a:: with SMTP id x26mr4390465ejy.199.1609969146750;
        Wed, 06 Jan 2021 13:39:06 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1609969146; cv=none;
        d=google.com; s=arc-20160816;
        b=OazwWLE8sH5p88rt/hfBIHtwFc092fmFuU1rvp3LBAm48v+UN3D9NNNLWPwL7F11qh
         J+dz2H4GlwbuWiDU0ifYn3T15pkUhoVi3VUPr8enj4SoqkaCUk+k1xvwWAShmAIotnmF
         GeY2g5B5rTHWQ9SY7THMqGnXv8R5d5kZH2QZI2ZVfWRpFi9m+cLXn84tEAgiNOC9e1rE
         tEVskgUvuSGkB01bZ42LQJT0sts1bF7JJShUj3y+pobG3TOpgKjtIeH0MZMkRFCsWJT7
         5MEuFd9dvqaMcYi4efUnAvIMlKXeax1b+72QyjjRqN/2DwfJEq4xMuenrRPTms1QG1cE
         /KxA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:mime-version:dkim-signature;
        bh=MYu4yDNZpoL0/i2h9TEoMfLRZ4RJlFXuGgKBJqrcTa0=;
        b=sQnD6Y9RanRtnwXgkYmwFVQtNdQCAnD9XHqup4rQBSIHv5hD2iTMACOmRUxWdqGEBu
         QwQz8Na14Ex9GDnqslK0bNsXZzyI4Wx4lbHtd2L+oXWw3AqE/WX92EFHChKOoMISyQKm
         /Bk5uTsdr2q6agOI7tt50VbDexqV31XTr86sy1vdRLYCnhx5HOZH+gaHLHai+SasKkxt
         8OOwr1PsvbIsuoWr9t3uMMjlQ9fNlEkwHOkg2qboiWUjHZdFB1vHlkOLpx1087Onqt0X
         +kTcKk1FWNvPALXZp+DAN8VSsBet3k5ZeU4itY7M2PrdWxMi+nVMj382VuoYLd8ryx3w
         WELg==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=fHWDzl30;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Return-Path: <stevebond@gmail.com>
Received: from mail-sor-f41.google.com (mail-sor-f41.google.com. [209.85.220.41])
        by mx.google.com with SMTPS id ch8sor4108218edb.19.2021.01.06.13.39.06
        for <josh@josh.is>
        (Google Transport Security);
        Wed, 06 Jan 2021 13:39:06 -0800 (PST)
Received-SPF: pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) client-ip=209.85.220.41;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=fHWDzl30;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:from:date:message-id:subject:to;
        bh=MYu4yDNZpoL0/i2h9TEoMfLRZ4RJlFXuGgKBJqrcTa0=;
        b=fHWDzl30p0VA7RLLzxOtYIVdkULMqqVHz/9ZX0bMByxk0HxB4mVvnDi5H2XLMrSQxV
         mQvLpajDZvVpbQ9sJUJUXguIFyW5b9VmJYfZ6zznMqGzD9qFZfgTGpXMzAOwY4sXrp6j
         xyyV9WFOwhJQ2trNHt8rGnSyRdLake5HZdPW8LxPNVDZ39CEWmP03kLh1uzFA2TYwKwx
         6nbf/XE67qa8Wcpd4y1dwu/8OVK2nGn6bS0UzaDnXXu9IC9kNX0LhVT2BnuxD7JY3TJK
         eel3YOgrAWPFqJbbaTxDiQd3Rpnyvr8HIZRfh+43vo8mmPDXQjfr+OXaJGN7xnUZH5ef
         Pu6w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;
        bh=MYu4yDNZpoL0/i2h9TEoMfLRZ4RJlFXuGgKBJqrcTa0=;
        b=rU7USVNXWoqBMRadFSX2rKa1T3C7cJlIgRg5JBn1c++xmAXgC9f68jqpyQKnzvenAE
         dd1HqLLmzVEaqYhRt2eIObRI67Cxh5kDkveDq84oHQlTdqkOrrb2M/F8llUry9F6H7PF
         WH/6p28U+i3Ggji6DBkv9+D+XbtBU6dbCtz2lkz0hnS+ZNNdVHTZfeof3+5cbcKLnR2I
         /NUITfhqPN7KsW1WGhCqZZ/4b9AJN50MgSd9hr+ssuIu5Vbf40v+rrC6eAtkOYpfPyyM
         4mDKBdEJ4nQC1RejpXrb08zZYPN+j7HBl6NHD+YnL0rEXA1D/dDra0DZVxCzFHVsukCs
         TvCA==
X-Gm-Message-State: AOAM530tvR5sJ8/ezODW4Z2duk+3kZYRVHv3Rnmsd0F+oF25xR1os8zZ
	/f4ShPBL0f6bBpv25PVdQYYIp5CqYWlqaf9SPFRFKwgCPPU=
X-Google-Smtp-Source: ABdhPJy7GGR8hCslL9abUaS5+2Dp1ubLdnjkfxXVKg09Z9iRo+uxzMztCemwL8x+nByT2o8mLv0/otFOk9llQAQT4cc=
X-Received: by 2002:a05:6402:352:: with SMTP id r18mr5160149edw.373.1609969146176;
 Wed, 06 Jan 2021 13:39:06 -0800 (PST)
MIME-Version: 1.0
From: Steve Bond <stevebond@gmail.com>
Date: Wed, 6 Jan 2021 13:38:55 -0800
Message-ID: <CAAdG8Ph0dzJfn6CSm01U8JwNe7x36fzqnXDbqaXV9of8qpqp-w@mail.gmail.com>
Subject: Reducing Crowbox power consumption
To: Josh Klein <josh@josh.is>
Content-Type: multipart/alternative; boundary="0000000000000ea84e05b8422721"

--0000000000000ea84e05b8422721
Content-Type: text/plain; charset="UTF-8"

This is an issue I want to push along a bit. If we can get the idle current
draw to come down a bit, people will get a lot more runtime from their
batteries and perhaps require less expensive solar panels.

In order to put an Arduino to sleep, you must have interrupts set to wake
it up.

The UNO only supports interrupts on pins 2 and 3. This is something I took
under consideration when pinning out the Crowbox; The coin sensor is
assigned to Pin2, and the perch switches to Pin3. This is good.

Currently, the coin sensor is already configured as an interrupt. This is
to ensure that a coin deposit is never missed, even if a coin is dropped in
while we're in a blocking operation like opening or closing the reward lid.
All deposits are counted and queued, and we pay out reward access for each
coin. All works just as we want it to.

The perch is NOT set up as an interrupt right now. It's a sensor that we
poll very frequently to detect state changes (bird arrives/bird leaves). We
don't poll this sensor during blocking operations like opening or closing
the lid. If we're already doing one of those two things, we don't really
care whether a bird leaves. The departure will be detected as soon as
whatever the sliding lid is doing completes.

To take a pin that's already set up to do some work as an interrupt (the
coin sensor) and set it to wake a sleeping Arduino is almost no work, so we
don't have to worry about the coin sensor.

I'm going to have to rewrite the logic for how we poll the perch for state
changes so it can function as an interrupt because we also need perch
activity to wake a sleeping Crowbox.

FOR NOW: I can ignore the perch and just write the code to sleep the
Arduino and wake it on deposit. That's all the work that's required to get
this fucker to sleep and measure the consumption. No sense reworking all
the perch logic if the sleep mode doesn't offer us significant energy
savings.

-Steve

--0000000000000ea84e05b8422721
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">This is an issue I want to push along a bit. If we can get=
 the idle current draw to come down a bit, people will get a lot more runti=
me from their batteries and perhaps require less expensive solar panels.=C2=
=A0<div><br></div><div>In order to put an Arduino to sleep, you must have i=
nterrupts set to wake it up.</div><div><br></div><div>The UNO only supports=
 interrupts on pins 2 and 3. This is something I took under consideration w=
hen pinning out the Crowbox; The coin sensor is assigned to Pin2, and the p=
erch switches to Pin3. This is good.</div><div><br></div><div>Currently,=C2=
=A0the coin sensor is already configured as an interrupt. This is to ensure=
 that a coin deposit is never missed, even if a coin is dropped in while we=
&#39;re in a blocking operation like opening or closing the reward lid. All=
 deposits are counted and queued, and we pay out reward access for each coi=
n. All works just as we want it to.</div><div><br></div><div>The perch is N=
OT set up as an interrupt right now. It&#39;s a sensor that we poll very fr=
equently to detect state changes (bird arrives/bird leaves). We don&#39;t p=
oll this sensor during blocking operations like opening or closing the lid.=
 If we&#39;re already doing one of those two things, we don&#39;t really ca=
re whether a bird leaves. The departure will be detected as soon as whateve=
r the sliding lid is doing completes.</div><div><br></div><div>To take a pi=
n that&#39;s already set up to do some work as an interrupt (the coin senso=
r) and set it to wake a sleeping Arduino is almost no work, so we don&#39;t=
 have to worry about the coin sensor.</div><div><br></div><div>I&#39;m goin=
g to have to rewrite the logic for how we poll the perch for state changes =
so it can function as an interrupt because we also need perch activity to w=
ake a sleeping Crowbox.</div><div><br></div><div>FOR NOW: I can ignore the =
perch and just write the code to sleep the Arduino and wake it on deposit. =
That&#39;s all the work that&#39;s required to get this fucker to sleep and=
 measure the consumption. No sense reworking all the perch logic if the sle=
ep mode doesn&#39;t offer us significant energy savings.</div><div><br></di=
v><div>-Steve</div><div><br></div></div>

--0000000000000ea84e05b8422721--
