MIME-Version: 1.0
Date: Wed, 6 Jan 2021 21:45:43 +0000
References: <CAAdG8Ph0dzJfn6CSm01U8JwNe7x36fzqnXDbqaXV9of8qpqp-w@mail.gmail.com>
In-Reply-To: <CAAdG8Ph0dzJfn6CSm01U8JwNe7x36fzqnXDbqaXV9of8qpqp-w@mail.gmail.com>
Message-ID: <CACNgykP2XsKcZ3hn6OBepJ1gUs9nBA1hqTxUHDc0pA-O9ksXBQ@mail.gmail.com>
Subject: Re: Reducing Crowbox power consumption
From: Josh Klein <josh@josh.is>
To: Steve Bond <stevebond@gmail.com>
Content-Type: multipart/alternative; boundary="000000000000c5a23d05b8423efa"

--000000000000c5a23d05b8423efa
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Ok, makes sense. Do you think it=E2=80=99s be a huge amount of work to redo=
 the
perch sensor logic if it DOES offer bug savings?

Stoked to find out how much juice this saves!!

- J


On Wed, Jan 6, 2021 at 9:39 PM Steve Bond <stevebond@gmail.com> wrote:

> This is an issue I want to push along a bit. If we can get the idle
> current draw to come down a bit, people will get a lot more runtime from
> their batteries and perhaps require less expensive solar panels.
>
> In order to put an Arduino to sleep, you must have interrupts set to wake
> it up.
>
> The UNO only supports interrupts on pins 2 and 3. This is something I too=
k
> under consideration when pinning out the Crowbox; The coin sensor is
> assigned to Pin2, and the perch switches to Pin3. This is good.
>
> Currently, the coin sensor is already configured as an interrupt. This is
> to ensure that a coin deposit is never missed, even if a coin is dropped =
in
> while we're in a blocking operation like opening or closing the reward li=
d.
> All deposits are counted and queued, and we pay out reward access for eac=
h
> coin. All works just as we want it to.
>
> The perch is NOT set up as an interrupt right now. It's a sensor that we
> poll very frequently to detect state changes (bird arrives/bird leaves). =
We
> don't poll this sensor during blocking operations like opening or closing
> the lid. If we're already doing one of those two things, we don't really
> care whether a bird leaves. The departure will be detected as soon as
> whatever the sliding lid is doing completes.
>
> To take a pin that's already set up to do some work as an interrupt (the
> coin sensor) and set it to wake a sleeping Arduino is almost no work, so =
we
> don't have to worry about the coin sensor.
>
> I'm going to have to rewrite the logic for how we poll the perch for stat=
e
> changes so it can function as an interrupt because we also need perch
> activity to wake a sleeping Crowbox.
>
> FOR NOW: I can ignore the perch and just write the code to sleep the
> Arduino and wake it on deposit. That's all the work that's required to ge=
t
> this fucker to sleep and measure the consumption. No sense reworking all
> the perch logic if the sleep mode doesn't offer us significant energy
> savings.
>
> -Steve
>
>

--000000000000c5a23d05b8423efa
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"auto">Ok, makes sense. Do you think it=E2=80=99s be a huge amou=
nt of work to redo the perch sensor logic if it DOES offer bug savings?</di=
v><div dir=3D"auto"><br></div><div dir=3D"auto">Stoked to find out how much=
 juice this saves!!</div><div dir=3D"auto"><br></div><div dir=3D"auto">- J<=
/div><div dir=3D"auto"><br></div><div><br><div class=3D"gmail_quote"><div d=
ir=3D"ltr" class=3D"gmail_attr">On Wed, Jan 6, 2021 at 9:39 PM Steve Bond &=
lt;<a href=3D"mailto:stevebond@gmail.com">stevebond@gmail.com</a>&gt; wrote=
:<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.=
8ex;border-left-width:1px;border-left-style:solid;padding-left:1ex;border-l=
eft-color:rgb(204,204,204)"><div dir=3D"ltr">This is an issue I want to pus=
h along a bit. If we can get the idle current draw to come down a bit, peop=
le will get a lot more runtime from their batteries and perhaps require les=
s expensive solar panels.=C2=A0<div><br></div><div>In order to put an Ardui=
no to sleep, you must have interrupts set to wake it up.</div><div><br></di=
v><div>The UNO only supports interrupts on pins 2 and 3. This is something =
I took under consideration when pinning out the Crowbox; The coin sensor is=
 assigned to Pin2, and the perch switches to Pin3. This is good.</div><div>=
<br></div><div>Currently,=C2=A0the coin sensor is already configured as an =
interrupt. This is to ensure that a coin deposit is never missed, even if a=
 coin is dropped in while we&#39;re in a blocking operation like opening or=
 closing the reward lid. All deposits are counted and queued, and we pay ou=
t reward access for each coin. All works just as we want it to.</div><div><=
br></div><div>The perch is NOT set up as an interrupt right now. It&#39;s a=
 sensor that we poll very frequently to detect state changes (bird arrives/=
bird leaves). We don&#39;t poll this sensor during blocking operations like=
 opening or closing the lid. If we&#39;re already doing one of those two th=
ings, we don&#39;t really care whether a bird leaves. The departure will be=
 detected as soon as whatever the sliding lid is doing completes.</div><div=
><br></div><div>To take a pin that&#39;s already set up to do some work as =
an interrupt (the coin sensor) and set it to wake a sleeping Arduino is alm=
ost no work, so we don&#39;t have to worry about the coin sensor.</div><div=
><br></div><div>I&#39;m going to have to rewrite the logic for how we poll =
the perch for state changes so it can function as an interrupt because we a=
lso need perch activity to wake a sleeping Crowbox.</div><div><br></div><di=
v>FOR NOW: I can ignore the perch and just write the code to sleep the Ardu=
ino and wake it on deposit. That&#39;s all the work that&#39;s required to =
get this fucker to sleep and measure the consumption. No sense reworking al=
l the perch logic if the sleep mode doesn&#39;t offer us significant energy=
 savings.</div></div><div dir=3D"ltr"><div><br></div><div>-Steve</div><div>=
<br></div></div>
</blockquote></div></div>

--000000000000c5a23d05b8423efa--