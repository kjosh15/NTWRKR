Delivered-To: josh@josh.is
Received: by 2002:a2e:b5af:0:0:0:0:0 with SMTP id f15csp553960ljn;
        Thu, 7 Jan 2021 09:33:25 -0800 (PST)
X-Received: by 2002:a17:906:fc3:: with SMTP id c3mr7394357ejk.474.1610040804901;
        Thu, 07 Jan 2021 09:33:24 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1610040804; cv=none;
        d=google.com; s=arc-20160816;
        b=gxs4pVRF7SXtxDsvehMiio4vapCJXKE3PCVJVpDFJlUH9LXL8vrxHJK7QY62GYyPcQ
         OzgBgjJVrkfhEZhzzLTLHb1raOEItbV7eyjWJFqek48gvQPInvoge44a66AFSFWR5qc/
         /GPXXDDBQzJXdVdp8WxMyy/ifUefEQH26BvVBpCVaKWAVmmGtQy6KzVp3nok5PBdC4Ka
         SK8tfoO8Mlu0mu+aXHUpG5UZ4qGoUFWjfVhEyb8ikENozgjA3/pPEFuUdC64JNv/vWR/
         tAfQqKzU6S+nUWwU1j1dNekqXtf+snqMEyJjbqzKn9GCPZTIoEQ7iM/b0ZJTTCV1cNGu
         AzdQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:in-reply-to:references:mime-version
         :dkim-signature;
        bh=3dasNoRAz+R3d7Lcz9F7pWqE6CrhY+zPYcxI1Lpaaa4=;
        b=uhWdHGdzXcSRl/XrrK375m4dB9kjDwge6Z8BbtqPFmElL7MHWrWHGxLFp6L/PvdmG2
         Zl+/82Dg1byWGpaJAGFC+I1i4z0gxbkINk7KONvwF24auOrGcjBGVoRQJ5z2OoIj3a2n
         DFlPgg5xcx96QC7CcbduhQNHWeQgMAOYzPZSIbv3TShHPmZ7mpT7UoEIsHV+ke0XeoLj
         Hjp/+WnqHL9CVvrDGPKIkEYEgST1PDgTtnvEODTxWIcrw1Qk5yMN1xH9+3LeEWstVvQ+
         DkA6sSLUu/9pMx1wVNFMn/2XhuS898X+hWfJIyDfyHKZQb+QMTDFioybn1BAL3EhT9Ea
         nJCw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=UfnBF+CK;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
Return-Path: <stevebond@gmail.com>
Received: from mail-sor-f41.google.com (mail-sor-f41.google.com. [209.85.220.41])
        by mx.google.com with SMTPS id lv27sor4293442ejb.14.2021.01.07.09.33.24
        for <josh@josh.is>
        (Google Transport Security);
        Thu, 07 Jan 2021 09:33:24 -0800 (PST)
Received-SPF: pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) client-ip=209.85.220.41;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@gmail.com header.s=20161025 header.b=UfnBF+CK;
       spf=pass (google.com: domain of stevebond@gmail.com designates 209.85.220.41 as permitted sender) smtp.mailfrom=stevebond@gmail.com;
       dmarc=pass (p=NONE sp=QUARANTINE dis=NONE) header.from=gmail.com
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to;
        bh=3dasNoRAz+R3d7Lcz9F7pWqE6CrhY+zPYcxI1Lpaaa4=;
        b=UfnBF+CKwEKNsStXk1NQeaYIAd3MTKnta6p+MbBeMEt8f5Hzoq7SgZ4NBDtlSw62FM
         a6L+apbyKTYsgINFR/NN62ic0LOgguvRR6XCotdP55hxVK1Hb+EpXq4Wt3/6ZFAA7MTM
         8mjIdsBKtrvGYQ/HqaNY8BX8UPfP/5A3H0JmV8qvhGUSCuE1XXuwVI8UIBIW7ln31aap
         ae1xNUBKYhfLy5FoVYtl/wbKruP9H7+HkargcEm1IWuSKj8y/+lSsMDXFl4CHyYsM/bA
         f67TAGuVY8CGizlL9Vqh4GE9ZXrSfky1aEHtdc1z4JylSOTKHBdsyJ+iOACu05aka0Ov
         5wYw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to;
        bh=3dasNoRAz+R3d7Lcz9F7pWqE6CrhY+zPYcxI1Lpaaa4=;
        b=cTw1o4K5TURfDsdvPSDZvCAs3LLZ3g9JysHFSWavUIie0zTG9E/88y+9e21g0foCMB
         eE+3g4TGLQAeVTLCF3uJnsAFnB8bIj7Qnss3bN4eWg/B2woxbn4+FyJ8xmJpKbiXO2YM
         run4xAnV4dtMTqShl9NM+S9qRfAkII7CORY4GulIXtASIJqH1FWUGW98COLvYXSsKFyU
         5tXmqzSBVpvZhOIiC1R+WtYVbTCEpxng4wU+6rUZlGvb7as4a+kuosDZ+NQyhjU13iE4
         4r2e+2uqJ559wQ9dXDytkFMohWl6JYYDeZnXSPJAxC+/WmhrWUJC49jgepGxRAIj9/vS
         kEQw==
X-Gm-Message-State: AOAM532s++0B9wA10CF1+q2g1ql4FDJDO5oUPCH6DCqUDydtqH45JgW9
	u3JZkb5NfXqwkmJQI3L4IQzFNU0t+YB1Uke1/r7Dz23MkQc=
X-Google-Smtp-Source: ABdhPJyhkwPZ6vBMoEawfwmi9v3ozKP/QSmXEMMpcjFs27HPzRD8y1wqSYDqWxYBHX8E5I/7DtFaU9ZimevOeT6cxZ4=
X-Received: by 2002:a17:907:a96:: with SMTP id by22mr6746143ejc.171.1610040804437;
 Thu, 07 Jan 2021 09:33:24 -0800 (PST)
MIME-Version: 1.0
References: <CAAdG8Ph0dzJfn6CSm01U8JwNe7x36fzqnXDbqaXV9of8qpqp-w@mail.gmail.com>
 <CACNgykP2XsKcZ3hn6OBepJ1gUs9nBA1hqTxUHDc0pA-O9ksXBQ@mail.gmail.com> <CAAdG8Pg=oeRjeM6Lm93d1PdZhkmz4Z+GtK-H-AEHs7p-Pr==6w@mail.gmail.com>
In-Reply-To: <CAAdG8Pg=oeRjeM6Lm93d1PdZhkmz4Z+GtK-H-AEHs7p-Pr==6w@mail.gmail.com>
From: Steve Bond <stevebond@gmail.com>
Date: Thu, 7 Jan 2021 09:33:13 -0800
Message-ID: <CAAdG8Ph49hA=B57X+ZhHVpcUKyhSAax+C+oKpAXUB-EE0prZhw@mail.gmail.com>
Subject: Re: Reducing Crowbox power consumption
To: Josh Klein <josh@josh.is>
Content-Type: multipart/alternative; boundary="00000000000038f09a05b852d6ee"

--00000000000038f09a05b852d6ee
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

I fiddled with the library last night to get familiar. We stayed up pretty
late and got up early today to follow the fucking madness that went down
yesterday.

In the next hour I'm headed to my office to write the Crowbox sleep test,
so I'll have more power data for us today.

I hooked my Crowbox to an ammeter yesterday and I got an idle current draw
of 53mA. The number we've had up to now is 47mA. It's weird that the number
is a bit different from my last round of tests but what matters most for
today is figuring out what our sleep current draw is so I'm going to crack
on there.

-Steve


On Wed, Jan 6, 2021 at 1:47 PM Steve Bond <stevebond@gmail.com> wrote:

> Nah, not a lot of work. Enough to perform the power measurements before
> investing in the code change, but not bad. I mean, half day or so. Then
> some testing.
>
>
>
> On Wed, Jan 6, 2021 at 1:45 PM Josh Klein <josh@josh.is> wrote:
>
>> Ok, makes sense. Do you think it=E2=80=99s be a huge amount of work to r=
edo the
>> perch sensor logic if it DOES offer bug savings?
>>
>> Stoked to find out how much juice this saves!!
>>
>> - J
>>
>>
>> On Wed, Jan 6, 2021 at 9:39 PM Steve Bond <stevebond@gmail.com> wrote:
>>
>>> This is an issue I want to push along a bit. If we can get the idle
>>> current draw to come down a bit, people will get a lot more runtime fro=
m
>>> their batteries and perhaps require less expensive solar panels.
>>>
>>> In order to put an Arduino to sleep, you must have interrupts set to
>>> wake it up.
>>>
>>> The UNO only supports interrupts on pins 2 and 3. This is something I
>>> took under consideration when pinning out the Crowbox; The coin sensor =
is
>>> assigned to Pin2, and the perch switches to Pin3. This is good.
>>>
>>> Currently, the coin sensor is already configured as an interrupt. This
>>> is to ensure that a coin deposit is never missed, even if a coin is dro=
pped
>>> in while we're in a blocking operation like opening or closing the rewa=
rd
>>> lid. All deposits are counted and queued, and we pay out reward access =
for
>>> each coin. All works just as we want it to.
>>>
>>> The perch is NOT set up as an interrupt right now. It's a sensor that w=
e
>>> poll very frequently to detect state changes (bird arrives/bird leaves)=
. We
>>> don't poll this sensor during blocking operations like opening or closi=
ng
>>> the lid. If we're already doing one of those two things, we don't reall=
y
>>> care whether a bird leaves. The departure will be detected as soon as
>>> whatever the sliding lid is doing completes.
>>>
>>> To take a pin that's already set up to do some work as an interrupt (th=
e
>>> coin sensor) and set it to wake a sleeping Arduino is almost no work, s=
o we
>>> don't have to worry about the coin sensor.
>>>
>>> I'm going to have to rewrite the logic for how we poll the perch for
>>> state changes so it can function as an interrupt because we also need p=
erch
>>> activity to wake a sleeping Crowbox.
>>>
>>> FOR NOW: I can ignore the perch and just write the code to sleep the
>>> Arduino and wake it on deposit. That's all the work that's required to =
get
>>> this fucker to sleep and measure the consumption. No sense reworking al=
l
>>> the perch logic if the sleep mode doesn't offer us significant energy
>>> savings.
>>>
>>> -Steve
>>>
>>>

--00000000000038f09a05b852d6ee
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I fiddled with the library last night to get familiar. We =
stayed up pretty late and got up early today to follow the fucking madness =
that went down yesterday.<div><br></div><div>In the next hour I&#39;m heade=
d to my office to write the Crowbox sleep test, so I&#39;ll have more power=
 data for us today.</div><div><br></div><div>I hooked my Crowbox to an amme=
ter yesterday and I got an idle current draw of 53mA. The number we&#39;ve =
had up to now is 47mA. It&#39;s weird that the number is a bit different fr=
om my last round of tests but what matters most for today is figuring out w=
hat our sleep current draw is so I&#39;m going to crack on there.=C2=A0</di=
v><div><br></div><div>-Steve</div><div><br></div></div><br><div class=3D"gm=
ail_quote"><div dir=3D"ltr" class=3D"gmail_attr">On Wed, Jan 6, 2021 at 1:4=
7 PM Steve Bond &lt;<a href=3D"mailto:stevebond@gmail.com">stevebond@gmail.=
com</a>&gt; wrote:<br></div><blockquote class=3D"gmail_quote" style=3D"marg=
in:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1e=
x"><div dir=3D"ltr">Nah, not a lot of work. Enough to perform the power mea=
surements before investing in the code change, but not bad. I mean, half da=
y or so. Then some testing.<div><br></div><div><br></div></div><br><div cla=
ss=3D"gmail_quote"><div dir=3D"ltr" class=3D"gmail_attr">On Wed, Jan 6, 202=
1 at 1:45 PM Josh Klein &lt;<a href=3D"mailto:josh@josh.is" target=3D"_blan=
k">josh@josh.is</a>&gt; wrote:<br></div><blockquote class=3D"gmail_quote" s=
tyle=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);pad=
ding-left:1ex"><div dir=3D"auto">Ok, makes sense. Do you think it=E2=80=99s=
 be a huge amount of work to redo the perch sensor logic if it DOES offer b=
ug savings?</div><div dir=3D"auto"><br></div><div dir=3D"auto">Stoked to fi=
nd out how much juice this saves!!</div><div dir=3D"auto"><br></div><div di=
r=3D"auto">- J</div><div dir=3D"auto"><br></div><div><br><div class=3D"gmai=
l_quote"><div dir=3D"ltr" class=3D"gmail_attr">On Wed, Jan 6, 2021 at 9:39 =
PM Steve Bond &lt;<a href=3D"mailto:stevebond@gmail.com" target=3D"_blank">=
stevebond@gmail.com</a>&gt; wrote:<br></div><blockquote class=3D"gmail_quot=
e" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204)=
;padding-left:1ex"><div dir=3D"ltr">This is an issue I want to push along a=
 bit. If we can get the idle current draw to come down a bit, people will g=
et a lot more runtime from their batteries and perhaps require less expensi=
ve solar panels.=C2=A0<div><br></div><div>In order to put an Arduino to sle=
ep, you must have interrupts set to wake it up.</div><div><br></div><div>Th=
e UNO only supports interrupts on pins 2 and 3. This is something I took un=
der consideration when pinning out the Crowbox; The coin sensor is assigned=
 to Pin2, and the perch switches to Pin3. This is good.</div><div><br></div=
><div>Currently,=C2=A0the coin sensor is already configured as an interrupt=
. This is to ensure that a coin deposit is never missed, even if a coin is =
dropped in while we&#39;re in a blocking operation like opening or closing =
the reward lid. All deposits are counted and queued, and we pay out reward =
access for each coin. All works just as we want it to.</div><div><br></div>=
<div>The perch is NOT set up as an interrupt right now. It&#39;s a sensor t=
hat we poll very frequently to detect state changes (bird arrives/bird leav=
es). We don&#39;t poll this sensor during blocking operations like opening =
or closing the lid. If we&#39;re already doing one of those two things, we =
don&#39;t really care whether a bird leaves. The departure will be detected=
 as soon as whatever the sliding lid is doing completes.</div><div><br></di=
v><div>To take a pin that&#39;s already set up to do some work as an interr=
upt (the coin sensor) and set it to wake a sleeping Arduino is almost no wo=
rk, so we don&#39;t have to worry about the coin sensor.</div><div><br></di=
v><div>I&#39;m going to have to rewrite the logic for how we poll the perch=
 for state changes so it can function as an interrupt because we also need =
perch activity to wake a sleeping Crowbox.</div><div><br></div><div>FOR NOW=
: I can ignore the perch and just write the code to sleep the Arduino and w=
ake it on deposit. That&#39;s all the work that&#39;s required to get this =
fucker to sleep and measure the consumption. No sense reworking all the per=
ch logic if the sleep mode doesn&#39;t offer us significant energy savings.=
</div></div><div dir=3D"ltr"><div><br></div><div>-Steve</div><div><br></div=
></div>
</blockquote></div></div>
</blockquote></div>
</blockquote></div>

--00000000000038f09a05b852d6ee--
